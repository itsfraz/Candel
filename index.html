<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(circle at center, #1a1a1a, #000);
      }

      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        position: relative;
      }

      /* Background Effects */
      .particles {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 0;
      }

      .particle {
        position: absolute;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 50%;
        animation: float 25s infinite linear;
      }

      .candle {
        position: relative;
        width: 30vw;
        height: 30vh;
        z-index: 2;
      }

      .candle-body {
        width: 15vw;
        height: 60vh;
        background: linear-gradient(
          45deg,
          #fff 0%,
          #f5f2eb 15%,
          #e3e0d8 40%,
          #d1c8b8 70%,
          #b8aa94 100%
        );
        border-radius: 3vw 3vw 1.5vw 1.5vw;
        box-shadow: inset 2vw 0 3vw -1vw rgba(0, 0, 0, 0.3),
          inset -2vw 0 3vw -1vw rgba(0, 0, 0, 0.3);
        margin: 0 auto;
        position: relative;
        filter: drop-shadow(0 0 2vw rgba(255, 140, 0, 0.2));
      }

      .flame-container {
        position: absolute;
        top: -20vh;
        left: 50%;
        transform: translateX(-50%);
      }

      .flame {
        overflow: visible;
        width: 5vw;
        height: 25vh;
        background: linear-gradient(
          180deg,
          #fff8e5 0%,
          #ffd700 20%,
          #ff8c00 60%,
          #ff4500 100%
        );
        border-radius: 50% 50% 35% 35%;
        transform-origin: bottom;
        animation: flicker 0.1s infinite alternate, sway 3s ease-in-out infinite;
        box-shadow: 0 0 5vw #ff8c00, 0 0 8vw #ff450055, 0 0 12vw #ff000033;
      }

      .glow {
        position: absolute;
        top: -10vh;
        left: -10vw;
        width: 20vw;
        height: 20vw;
        background: radial-gradient(
          circle,
          rgba(255, 165, 0, 0.3) 0%,
          rgba(255, 165, 0, 0) 70%
        );
        filter: blur(5vw);
        animation: glow-pulse 2s ease-in-out infinite;
        transition:
          transform 0.6s cubic-bezier(.4,1.6,.4,1),
          filter 0.6s cubic-bezier(.4,1.6,.4,1),
          box-shadow 0.6s cubic-bezier(.4,1.6,.4,1);
        pointer-events: none;
      }

      .candle:hover .glow {
        transform: scale(1.25);
        filter: blur(7vw);
        /* Optional: add a soft box-shadow for extra bloom */
        box-shadow: 0 0 8vw 2vw rgba(255, 200, 80, 0.18);
      }

      .melt {
        position: absolute;
        width: 1.5vw;
        height: 4vh;
        background: linear-gradient(to right, #d1c8b8 0%, #b8aa94 100%);
        border-radius: 0 0 1vw 1vw;
        box-shadow: inset 0.3vw 0 0.5vw rgba(0, 0, 0, 0.1);
        opacity: 0;
      }

      .melt-1 {
        left: 20%;
        top: 90%;
        animation: melt 15s infinite;
      }
      .melt-2 {
        left: 60%;
        top: 88%;
        animation: melt 18s infinite 5s;
      }

      /* Animations */
      @keyframes flicker {
        0% {
          transform: scaleY(1) skew(1deg);
        }
        100% {
          transform: scaleY(1.08) skew(-1deg);
        }
      }

      @keyframes sway {
        0%,
        100% {
          transform: rotate(2deg);
        }
        50% {
          transform: rotate(-2deg);
        }
      }

      @keyframes glow-pulse {
        0%,
        100% {
          opacity: 0.6;
          transform: scale(1);
        }
        50% {
          opacity: 0.3;
          transform: scale(1.1);
        }
      }

      @keyframes melt {
        0% {
          transform: translateY(0);
          opacity: 0;
        }
        20% {
          opacity: 0.8;
        }
        100% {
          transform: translateY(20vh);
          opacity: 0;
        }
      }

      @keyframes float {
        from {
          transform: translateY(100vh);
        }
        to {
          transform: translateY(-100vh);
        }
      }

      .shadow {
        position: absolute;
        width: 25vw;
        height: 5vh;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        bottom: 2vh;
        left: 50%;
        transform: translateX(-50%);
        filter: blur(3vw);
      }

      .sparkles {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
      }

      .spark {
        position: absolute;
        background: rgba(255, 255, 255, 0.9);
        width: 2px;
        height: 2px;
        border-radius: 50%;
        animation: sparkle 1.5s infinite;
        filter: blur(0.5px);
      }

      @keyframes sparkle {
        0% {
          transform: translateY(0) scale(0);
          opacity: 0;
        }
        20% {
          transform: translateY(-10vh) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-25vh) scale(0);
          opacity: 0;
        }
      }

      /* Vignette Effect */
      .vignette {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          transparent 60%,
          rgba(0, 0, 0, 0.7)
        );
        pointer-events: none;
      }

      .heatwave {
        position: absolute;
        left: 50%;
        top: -8vh;
        width: 7vw;
        height: 22vh;
        transform: translateX(-50%);
        pointer-events: none;
        z-index: 3;
        opacity: 0.45;
        background: repeating-linear-gradient(
          120deg,
          rgba(255,255,255,0.08) 0 8%,
          rgba(255,255,255,0.18) 8% 16%,
          rgba(255,255,255,0.08) 16% 24%
        );
        filter: blur(2.5px) contrast(1.2) brightness(1.1);
        animation: heatwave-rise 2.2s linear infinite, heatwave-wobble 1.2s ease-in-out infinite alternate;
        mix-blend-mode: lighten;
      }

      @keyframes heatwave-rise {
        0% {
          opacity: 0.35;
          transform: translateX(-50%) translateY(0) scaleX(1) scaleY(1);
        }
        70% {
          opacity: 0.55;
        }
        100% {
          opacity: 0;
          transform: translateX(-50%) translateY(-8vh) scaleX(1.08) scaleY(1.12);
        }
      }
      @keyframes heatwave-wobble {
        0% { filter: blur(2.5px) contrast(1.2) brightness(1.1); }
        50% { filter: blur(3.2px) contrast(1.25) brightness(1.13); }
        100% { filter: blur(2.5px) contrast(1.2) brightness(1.1); }
      }

      @media (orientation: landscape) {
        .candle {
          width: 40vh;
        }
        .candle-body {
          width: 20vh;
        }
      }

      .stars-layer {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }
      #stars-back { z-index: 0; }
      #stars-mid { z-index: 1; }
      #stars-front { z-index: 2; }

      .star {
        position: absolute;
        border-radius: 50%;
        background: white;
        opacity: 0.7;
        pointer-events: none;
        will-change: transform, opacity;
        filter: blur(0.2px);
        animation: star-twinkle 2.5s infinite alternate;
      }
      .star.mid {
        opacity: 0.85;
        filter: blur(0.5px);
        animation-duration: 2s;
      }
      .star.front {
        opacity: 1;
        filter: blur(0.1px);
        animation-duration: 1.5s;
      }

      @keyframes star-twinkle {
        0%   { opacity: 0.6; }
        50%  { opacity: 1; }
        100% { opacity: 0.7; }
      }

      #fireflies {
        position: absolute;
        left: 0; top: 0;
        width: 100vw; height: 100vh;
        pointer-events: none;
        z-index: 4;
      }
      .firefly {
        position: absolute;
        width: 1.2vw;
        height: 1.2vw;
        border-radius: 50%;
        background: radial-gradient(circle, #fffbe6 0%, #ffe066 40%, #ffb70000 100%);
        box-shadow: 0 0 1vw 0.3vw #ffe06699, 0 0 2vw 0.5vw #fffbe655;
        opacity: 0.85;
        animation: firefly-blink 2.5s infinite;
        will-change: opacity, filter;
        filter: blur(0.2vw);
        transition: opacity 0.3s;
      }
      @keyframes firefly-blink {
        0%, 100% { opacity: 0.85; filter: blur(0.2vw);}
        10% { opacity: 0.2; filter: blur(0.4vw);}
        20% { opacity: 1; filter: blur(0vw);}
        30% { opacity: 0.5; }
        60% { opacity: 1; }
        80% { opacity: 0.3; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="vignette"></div>
      <!-- Starry parallax background layers -->
      <div class="stars-layer" id="stars-back"></div>
      <div class="stars-layer" id="stars-mid"></div>
      <div class="stars-layer" id="stars-front"></div>
      <div class="particles"></div>
      <!-- Fireflies layer -->
      <div id="fireflies"></div>

      <div class="candle">
        <div class="flame-container">
          <!-- Add this inside the flame div -->
          <div class="sparkles" id="sparkles-container"></div>
          <div class="glow"></div>
          <div class="flame"></div>
          <!-- Heatwave distortion effect -->
          <div class="heatwave"></div>
        </div>
        <div class="candle-body">
          <div class="melt melt-1"></div>
          <div class="melt melt-2"></div>
          <!-- Wax drips will be injected here -->
          <div id="wax-drips"></div>
          <div id="wax-pool"></div>
        </div>
        <div class="shadow"></div>
      </div>
    </div>

    <!-- Ambient fire audio (hidden) -->
    <audio id="fire-audio" src="fire-crackle.mp3" loop autoplay style="display:none"></audio>

    <script>
      // Add floating particles
      const particles = document.querySelector(".particles");
      const particleCount = 15;
      const particleData = [];
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement("div");
        particle.className = "particle";
        const left = Math.random() * 100;
        particle.style.left = `${left}%`;
        const size = Math.random() * 2 + 1;
        particle.style.width = particle.style.height = `${size}px`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animation = "none"; // We'll animate with JS
        particles.appendChild(particle);
        particleData.push({
          el: particle,
          x: left,
          y: Math.random() * 100,
          speed: 0.02 + Math.random() * 0.03,
          drift: 0,
        });
      }

      // Add sparkles dynamically
      function createSparkles() {
        const container = document.getElementById("sparkles-container");
        const sparkCount = 15;

        for (let i = 0; i < sparkCount; i++) {
          const spark = document.createElement("div");
          spark.className = "spark";
          spark.style.left = `${Math.random() * 100}%`;
          spark.style.animationDelay = `${Math.random() * 2}s`;
          spark.style.animationDuration = `${0.5 + Math.random() * 1.5}s`;
          spark.style.width = spark.style.height = `${1 + Math.random() * 2}px`;
          container.appendChild(spark);
        }
      }
      createSparkles();

      // --- Wind Simulation ---
      let wind = 0; // -1 (left) to 1 (right)
      let targetWind = 0;
      let lastGust = Date.now();

      // Mouse controls wind
      document.addEventListener("mousemove", (e) => {
        const center = window.innerWidth / 2;
        const max = window.innerWidth / 2;
        targetWind = Math.max(-1, Math.min(1, (e.clientX - center) / max));
      });

      // Random gusts if no mouse movement
      setInterval(() => {
        // If mouse hasn't moved for 2s, random gust
        if (Date.now() - lastGust > 2000) {
          targetWind = (Math.random() - 0.5) * 1.5; // -0.75 to 0.75
        }
      }, 2000);

      document.addEventListener("mousemove", () => {
        lastGust = Date.now();
      });

      // Animate flame, particles, and glow
      const flame = document.querySelector(".flame");
      const glow = document.querySelector(".glow");

      function animate() {
        // Smooth wind transition
        wind += (targetWind - wind) * 0.03;

        // --- Flame bending ---
        // Max bend: -18deg (left) to 18deg (right)
        const bend = wind * 18;
        // Slight squash/stretch for realism
        const scaleX = 1 - Math.abs(wind) * 0.15;
        const scaleY = 1 + Math.abs(wind) * 0.12;
        flame.style.transform =
          `rotate(${bend}deg) scaleX(${scaleX}) scaleY(${scaleY})`;

        // --- Glow distortion ---
        // Move glow in wind direction, squash a bit
        glow.style.transform =
          `translateX(${wind * 4}vw) scaleX(${1 + Math.abs(wind) * 0.2}) scaleY(${1 - Math.abs(wind) * 0.08})`;

        // --- Particle drift ---
        for (let p of particleData) {
          // Drift horizontally with wind
          p.x += wind * 0.08 + (Math.random() - 0.5) * 0.01;
          p.y -= p.speed;
          // Wrap around
          if (p.y < -2) {
            p.y = 102;
            p.x = Math.random() * 100;
          }
          if (p.x < 0) p.x = 100;
          if (p.x > 100) p.x = 0;
          p.el.style.left = `${p.x}%`;
          p.el.style.top = `${p.y}%`;
        }

        requestAnimationFrame(animate);
      }
      animate();

      // --- Wax Drip Animation ---
      const waxDripContainer = document.getElementById("wax-drips");
      const waxPool = document.getElementById("wax-pool");

      // Style for wax pool
      waxPool.style.position = "absolute";
      waxPool.style.left = "50%";
      waxPool.style.bottom = "-2vh";
      waxPool.style.transform = "translateX(-50%)";
      waxPool.style.width = "0vw";
      waxPool.style.height = "1.5vh";
      waxPool.style.background = "radial-gradient(ellipse at center, #f5f2eb 60%, #e3e0d8 100%)";
      waxPool.style.borderRadius = "50%";
      waxPool.style.opacity = "0";
      waxPool.style.pointerEvents = "none";
      waxPool.style.zIndex = "1";

      function createWaxDrip() {
        const drip = document.createElement("div");
        drip.className = "wax-drip";
        // Random horizontal start (within candle width)
        const left = 15 + Math.random() * 70; // percent
        drip.style.position = "absolute";
        drip.style.left = left + "%";
        drip.style.top = "0";
        drip.style.width = 0.7 + Math.random() * 0.7 + "vw";
        drip.style.height = 4 + Math.random() * 6 + "vh";
        drip.style.background = "linear-gradient(to bottom, #fffbe9 0%, #e3e0d8 100%)";
        drip.style.borderRadius = "1vw";
        drip.style.opacity = "0.85";
        drip.style.pointerEvents = "none";
        drip.style.zIndex = "2";
        drip.style.transform = "translateY(0) scaleX(" + (0.7 + Math.random() * 0.6) + ")";
        waxDripContainer.appendChild(drip);

        // Random path curve
        const curve = (Math.random() - 0.5) * 10; // px

        // Animate drip
        let progress = 0;
        const duration = 1800 + Math.random() * 1200; // ms
        const start = performance.now();

        function animateDrip(now) {
          progress = (now - start) / duration;
          if (progress > 1) progress = 1;
          // Gravity curve: ease-in
          const y = progress * 38; // vh
          const x = Math.sin(progress * Math.PI) * curve;
          drip.style.transform =
            `translateY(${y}vh) translateX(${x}px) scaleX(${0.7 + Math.random() * 0.6})`;

          // Fade out at end
          if (progress > 0.85) {
            drip.style.opacity = (1 - progress) * 1.2;
          }

          if (progress < 1) {
            requestAnimationFrame(animateDrip);
          } else {
            drip.remove();
            // Pool effect
            showWaxPool(left);
          }
        }
        requestAnimationFrame(animateDrip);
      }

      // Pool animation
      function showWaxPool(leftPercent) {
        // Expand and fade pool
        waxPool.style.transition = "none";
        waxPool.style.opacity = "0.7";
        waxPool.style.width = "0vw";
        waxPool.style.left = leftPercent + "%";
        setTimeout(() => {
          waxPool.style.transition = "width 1.2s cubic-bezier(.4,1.6,.4,1), opacity 2s";
          waxPool.style.width = 2.5 + Math.random() * 2 + "vw";
          waxPool.style.opacity = "0";
        }, 10);
      }

      // Loop to create random drips
      function waxDripLoop() {
        createWaxDrip();
        setTimeout(waxDripLoop, 1200 + Math.random() * 1800);
      }
      waxDripLoop();

      // --- Wax Drip CSS ---
      const waxDripStyle = document.createElement("style");
      waxDripStyle.innerHTML = `
        .wax-drip {
          box-shadow: 0 0 0.5vw #e3e0d888;
          transition: opacity 0.5s;
        }
        #wax-pool {
          transition: width 1.2s cubic-bezier(.4,1.6,.4,1), opacity 2s;
        }
      `;
      document.head.appendChild(waxDripStyle);

      // --- Starry Parallax Background ---
      function createStars(layerId, count, sizeRange, className) {
        const layer = document.getElementById(layerId);
        for (let i = 0; i < count; i++) {
          const star = document.createElement("div");
          star.className = "star" + (className ? " " + className : "");
          const size = sizeRange[0] + Math.random() * (sizeRange[1] - sizeRange[0]);
          star.style.width = star.style.height = size + "px";
          star.style.left = Math.random() * 100 + "vw";
          star.style.top = Math.random() * 100 + "vh";
          star.style.opacity = (0.6 + Math.random() * 0.4).toFixed(2);
          star.style.animationDelay = (Math.random() * 2) + "s";
          layer.appendChild(star);
        }
      }
      createStars("stars-back", 60, [0.7, 1.5], "");
      createStars("stars-mid", 40, [1.2, 2.2], "mid");
      createStars("stars-front", 20, [1.5, 2.8], "front");

      // Animate parallax movement
      const starLayers = [
        { id: "stars-back", speed: 0.02 },
        { id: "stars-mid", speed: 0.06 },
        { id: "stars-front", speed: 0.12 }
      ];
      let starOffsets = [0, 0, 0];

      function animateStars() {
        starLayers.forEach((layer, idx) => {
          starOffsets[idx] += layer.speed;
          const stars = document.getElementById(layer.id).children;
          for (let s = 0; s < stars.length; s++) {
            // Move stars upward and wrap
            const star = stars[s];
            let top = parseFloat(star.style.top);
            top -= layer.speed;
            if (top < 0) top = 100;
            star.style.top = top + "vh";
          }
        });
        requestAnimationFrame(animateStars);
      }
      animateStars();

      // --- Ambient Crackling Fire Audio & Visual Sync ---
      // Make sure fire-crackle.mp3 is present in your project folder

      const audio = document.getElementById('fire-audio');
      let audioCtx, analyser, source, dataArray;

      function setupAudioAnalysis() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        source = audioCtx.createMediaElementSource(audio);
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 64;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
      }

      // Resume audio context on user gesture (required by browsers)
      document.body.addEventListener('click', () => {
        if (!audioCtx) {
          setupAudioAnalysis();
          audio.play();
        } else if (audioCtx.state === 'suspended') {
          audioCtx.resume();
        }
      }, { once: true });

      // Flicker sync variables
      let lastAudioFlicker = 0;

      function audioFlickerSync() {
        if (analyser && dataArray) {
          analyser.getByteFrequencyData(dataArray);
          // Use higher frequencies for crackle, lower for general fire
          const low = dataArray.slice(0, 4).reduce((a, b) => a + b, 0) / 4;
          const high = dataArray.slice(4).reduce((a, b) => a + b, 0) / (dataArray.length - 4);

          // Map to [0,1]
          const lowNorm = Math.min(1, low / 128);
          const highNorm = Math.min(1, high / 128);

          // Flame brightness: scaleY and box-shadow intensity
          const flameEl = document.querySelector('.flame');
          const glowEl = document.querySelector('.glow');
          if (flameEl && glowEl) {
            // Subtle scale and shadow flicker
            const scale = 1 + lowNorm * 0.10 + highNorm * 0.05;
            const shadow = 5 + lowNorm * 10 + highNorm * 8;
            flameEl.style.filter = `brightness(${1 + highNorm * 0.25})`;
            flameEl.style.boxShadow = `0 0 ${shadow}vw #ff8c00, 0 0 ${shadow * 1.5}vw #ff450055, 0 0 ${shadow * 2}vw #ff000033`;
            flameEl.style.transform += ` scaleY(${scale})`;

            // Glow flicker
            glowEl.style.opacity = 0.6 + highNorm * 0.25;
            glowEl.style.filter = `blur(${5 + highNorm * 3}vw)`;
          }
        }
        requestAnimationFrame(audioFlickerSync);
      }

      // Start flicker sync after audio context is ready
      function tryStartAudioSync() {
        if (analyser && dataArray) {
          audioFlickerSync();
        } else {
          setTimeout(tryStartAudioSync, 300);
        }
      }
      tryStartAudioSync();

      // --- Fireflies Animation ---
      const fireflyCount = 10;
      const fireflies = [];
      const fireflyContainer = document.getElementById("fireflies");
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2 + 60;

      for (let i = 0; i < fireflyCount; i++) {
        const el = document.createElement("div");
        el.className = "firefly";
        // Randomize blink animation
        el.style.animationDelay = (Math.random() * 2.5) + "s";
        fireflyContainer.appendChild(el);
        fireflies.push({
          el,
          // Orbit parameters
          angle: Math.random() * Math.PI * 2,
          radius: 10 + Math.random() * 18, // vw
          yRadius: 7 + Math.random() * 8,  // vh
          speed: 0.005 + Math.random() * 0.003,
          phase: Math.random() * Math.PI * 2,
          verticalDrift: Math.random() * 0.5 + 0.5,
        });
      }

      function animateFireflies() {
        const t = performance.now() / 1000;
        fireflies.forEach((f, i) => {
          // Curved, floating path
          const a = f.angle + t * f.speed + Math.sin(t * 0.3 + f.phase) * 0.2;
          const x = centerX + Math.cos(a) * f.radius * 16; // vw to px
          const y = centerY + Math.sin(a) * f.yRadius * 10 + Math.sin(t * f.verticalDrift + f.phase) * 12;
          f.el.style.left = `${x}px`;
          f.el.style.top = `${y}px`;
        });
        requestAnimationFrame(animateFireflies);
      }
      animateFireflies();
    </script>
  </body>
</html>
